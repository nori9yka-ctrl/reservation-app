<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ãƒ¬ãƒ³ã‚¿ãƒ«äºˆç´„</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://npmcdn.com/flatpickr/dist/l10n/ja.js"></script>
  <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <style>
    /* ãƒ‡ã‚¶ã‚¤ãƒ³ (å…±é€š) */
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: #f0f4f8; padding: 20px; color: #333; padding-bottom: 120px; }
    .card { background: white; border-radius: 16px; padding: 24px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); max-width: 480px; margin: 0 auto; }
    h2 { text-align: center; font-size: 1.3rem; margin-bottom: 20px; color: #06C755; font-weight: bold; }
    
    /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° */
    #loading { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 9999; display: flex; justify-content: center; align-items: center; flex-direction: column; color: #666; font-weight: bold; }

    label { display: block; font-weight: bold; font-size: 0.85rem; margin-bottom: 8px; color: #555; margin-top: 15px; }
    .required::after { content: "å¿…é ˆ"; background: #ff4b4b; color: white; font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; margin-left: 8px; vertical-align: middle; }
    .optional::after { content: "ä»»æ„"; background: #aaa; color: white; font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; margin-left: 8px; vertical-align: middle; }
    input:not([type="checkbox"]), select, textarea { width: 100%; padding: 14px; border: 1px solid #ddd; border-radius: 10px; font-size: 16px; box-sizing: border-box; background: #fff; -webkit-appearance: none; }
    input:focus, select:focus { border-color: #06C755; outline: none; background: #f9fff9; }
    
    .zip-group { display: flex; gap: 10px; } .zip-group input { width: 120px; } .zip-group button { width: auto; padding: 0 15px; background: #666; color: white; border-radius: 10px; border:none; cursor:pointer;}
    .price-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: white; border-top: 1px solid #ddd; padding: 15px 20px; display: none; justify-content: space-between; align-items: center; box-sizing: border-box; z-index: 100; }
    .total-price { font-size: 1.4rem; font-weight: bold; color: #06C755; }
    
    .screen { display: none; } .screen.active { display: block; }

    #bike-image-container { text-align: center; margin-bottom: 15px; display: none; }
    #bike-image { max-width: 100%; max-height: 200px; border-radius: 8px; border: 1px solid #eee; object-fit: cover; }
    .option-row { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #f0f0f0; }
    .option-select { width: 80px; padding: 8px; margin-bottom: 0; }
    
    .confirm-table { width: 100%; border-collapse: collapse; margin-top: 10px; } .confirm-table th { text-align: left; padding: 10px; border-bottom: 1px solid #eee; color: #888; width: 35%; } .confirm-table td { text-align: right; padding: 10px; border-bottom: 1px solid #eee; font-weight: bold; }
    .btn-group { display: flex; gap: 10px; margin-top: 20px; } 
    .btn-back { width: 40%; background: #ccc; color: white; border: none; padding: 15px; border-radius: 30px; font-weight: bold; cursor: pointer; } 
    .btn-primary { width: 60%; background: #ccc; color: white; border: none; padding: 15px; border-radius: 30px; font-weight: bold; cursor: not-allowed; } 
    .btn-primary.active { background: #06C755; cursor: pointer; }
    .btn-primary.sending { background: #555 !important; cursor: wait !important; }

    #descModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 3000; justify-content: center; align-items: center; }
    .desc-content { background: white; padding: 25px; border-radius: 12px; width: 80%; max-width: 300px; text-align: center; }
    .desc-close { background: #333; color: white; border: none; padding: 8px 20px; border-radius: 20px; cursor: pointer; margin-top: 15px; }
  </style>
</head>
<body>
  <div id="loading"><div>ğŸš€ èª­ã¿è¾¼ã¿ä¸­...</div></div>

  <div id="input-screen" class="screen">
    <div class="card">
      <div style="text-align:center; margin-bottom:10px;">ã‚ˆã†ã“ã <span id="user-name" style="font-weight:bold;">ã‚²ã‚¹ãƒˆ</span> ã•ã‚“</div>
      <h2>ãƒ¬ãƒ³ã‚¿ãƒ«äºˆç´„</h2>
      
      <div id="guest-form">
        <label class="required">ãŠåå‰</label><input type="text" id="regName" placeholder="ä¾‹ï¼šå±±ç”° å¤ªéƒ">
        <label class="required">ãµã‚ŠãŒãª</label><input type="text" id="regKana" placeholder="ä¾‹ï¼šã‚„ã¾ã  ãŸã‚ã†">
        <label class="required">é›»è©±ç•ªå·</label><input type="tel" id="regPhone" placeholder="090-1234-5678">
        <label class="optional">éƒµä¾¿ç•ªå·</label><div class="zip-group"><input type="tel" id="zipcode" placeholder="7æ¡"><button onclick="searchAddress()">æ¤œç´¢</button></div>
        <label class="required">ä½æ‰€</label><input type="text" id="regAddress" placeholder="å¸‚åŒºç”ºæ‘ãƒ»ç•ªåœ°">
      </div>

      <label class="required">ã”åˆ©ç”¨æœŸé–“</label><input type="text" id="dateRange" class="calendar-input" placeholder="æœŸé–“ã‚’é¸æŠ" readonly>
      <div style="display:flex; gap:10px;"><div style="flex:1;"><label>è²¸æ¸¡æ™‚é–“</label><select id="startTime" onchange="calcTotal()"></select></div><div style="flex:1;"><label>è¿”å´æ™‚é–“</label><select id="endTime" onchange="calcTotal()"></select></div></div>
      <div id="days-display" style="text-align:right; font-size:0.8rem; color:#888; margin-top:4px;">0æ™‚é–“</div>
      <div style="font-size:0.75rem; color:#d00; margin-top:5px;">â€»æœ¨æ›œå®šä¼‘ã®ãŸã‚è²¸å‡ºä¸å¯</div>

      <label class="required">æ’æ°—é‡ã‚¯ãƒ©ã‚¹</label><select id="classSelect" onchange="updateBikeList()"><option>èª­ã¿è¾¼ã¿ä¸­...</option></select>
      <label class="required">è»Šç¨®é¸æŠ</label><select id="bikeSelect" onchange="showBikeImage(); calcTotal();" disabled><option value="0">å…ˆã«ã‚¯ãƒ©ã‚¹ã‚’é¸æŠ</option></select>
      <div id="bike-image-container"><img id="bike-image" src=""></div>

      <label>ã‚ªãƒ—ã‚·ãƒ§ãƒ³é¸æŠ</label><div id="optionArea"></div>
      <label>å‚™è€ƒ</label><textarea id="memo" style="height:80px;"></textarea>
      <div style="height:60px;"></div>
    </div>
  </div>

  <div id="confirm-screen" class="screen">
    <div class="card">
      <h2>ã”äºˆç´„å†…å®¹ã®ç¢ºèª</h2>
      <table class="confirm-table"><tr><th>ãŠåå‰</th><td id="conf-name"></td></tr><tr><th>é›»è©±</th><td id="conf-phone"></td></tr><tr><th>æœŸé–“</th><td id="conf-date" style="font-size:0.9rem;"></td></tr><tr><th>æ™‚é–“</th><td id="conf-time"></td></tr><tr><th>è»Šä¸¡</th><td id="conf-bike"></td></tr><tr><th>OP</th><td id="conf-options" style="font-size:0.8rem;"></td></tr></table>
      <div style="text-align:center; padding:20px; background:#f0f0f0; border-radius:10px; margin-top:20px;">
        <div style="font-size:0.9rem; color:#555;">ãŠæ”¯æ‰•ã„äºˆå®šç·é¡</div><div class="total-price" id="conf-price">Â¥0</div>
      </div>
      <div style="background-color:#fff8f0; border:1px solid #e0c0a0; border-radius:8px; padding:15px; margin-top:20px; font-size:0.9rem;">
        <div style="font-weight:bold; margin-bottom:10px; text-align:center;">âš ï¸ é‡è¦äº‹é …ã®ç¢ºèª</div>
        <label style="display:flex; align-items:center; margin-bottom:10px;"><input type="checkbox" id="checkTerms" onchange="checkAgreements()" style="width:20px; margin-right:10px;"> åˆ©ç”¨è¦ç´„ã«åŒæ„ã—ã¾ã™ã€‚</label>
        <label style="display:flex; align-items:center;"><input type="checkbox" id="checkAge" onchange="checkAgreements()" style="width:20px; margin-right:10px;"> 18æ­³ä»¥ä¸Šã§ã‚ã‚‹ã“ã¨ã‚’èª“ç´„ã—ã¾ã™ã€‚</label>
      </div>
      <div class="btn-group"><button class="btn-back" onclick="goBack()">ä¿®æ­£ã™ã‚‹</button><button class="btn-primary" id="finalSubmitBtn" onclick="sendToGas()" disabled>äºˆç´„ç¢ºå®š</button></div>
    </div>
  </div>

  <div class="price-bar" id="price-bar"><div><div style="font-size:0.8rem;">äºˆå®šé¡</div><div class="total-price" id="totalPriceDisplay">Â¥0</div></div><button class="btn-submit" style="background:#06C755; color:white; border:none; padding:10px 20px; border-radius:20px; font-weight:bold;" onclick="showConfirm()">ç¢ºèªã¸é€²ã‚€</button></div>
  <div id="descModal"><div class="desc-content"><div style="font-weight:bold; margin-bottom:10px;" id="desc-title"></div><div id="desc-text"></div><button class="desc-close" onclick="document.getElementById('descModal').style.display='none'">é–‰ã˜ã‚‹</button></div></div>

  <script>
    // â˜…é‡è¦: GASã®ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªURLã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„
    const GAS_URL = "https://script.google.com/macros/s/AKfycbxWvKydNXGLMLBDXLkigRBnJJeJgRLttFlruTFbDLCFNaKagLONSf_9JOT9hXjFaup_9w/exec";
    const MY_LIFF_ID = "2008826232-lvGwqtl1";

    let masterData = { categories: [], options: [] };
    let allReservations = []; 
    let fpInstance; 
    let lineProfile = null; 

    // â˜… GitHubä¸Šã§GASã¨é€šä¿¡ã™ã‚‹ãŸã‚ã®é–¢æ•° (Webç‰ˆã¨åŒã˜ä»•çµ„ã¿)
    function callGas(action, params = {}) {
      return fetch(GAS_URL, {
        method: 'POST',
        body: JSON.stringify({ action: action, ...params })
      }).then(response => response.json());
    }

    window.onload = function() {
      generateTimeOptions('startTime', 9, 18); generateTimeOptions('endTime', 0, 23);
      
      // 1. ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾—
      callGas("get_master_data").then(d => {
        if(d.result==='success') {
          masterData.categories=d.categories; masterData.options=d.options;
          initClassSelect(); initOptionSelect();
          return callGas("get_reserved_ranges");
        } else { throw new Error("ãƒã‚¹ã‚¿å–å¾—å¤±æ•—"); }
      }).then(d => {
        if(d && d.result==='success') allReservations=d.data;
        
        // 2. LIFFåˆæœŸåŒ– (GitHubä¸Šã§ã‚‚å‹•ä½œã—ã¾ã™)
        return liff.init({ liffId: MY_LIFF_ID });
      }).then(() => {
        if (liff.isLoggedIn()) {
          // ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ãªã‚‰ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—
          return liff.getProfile();
        } else {
          // æœªãƒ­ã‚°ã‚¤ãƒ³ãªã‚‰LINEãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã¸é£›ã°ã™
          liff.login();
          return null;
        }
      }).then(profile => {
        if(profile) {
          lineProfile = profile;
          document.getElementById('user-name').innerText = profile.displayName;
          // 3. GASã¸å•ã„åˆã‚ã›ã¦å±¥æ­´ãŒã‚ã‚‹ã‹ç¢ºèª
          return callGas("check", {userId: profile.userId});
        }
      }).then(res => {
        if(res && res.result==='found') {
          const u = res.userData;
          document.getElementById('regName').value = u.regName;
          document.getElementById('regKana').value = u.regKana;
          document.getElementById('regPhone').value = u.regPhone;
          document.getElementById('zipcode').value = u.regZip;
          document.getElementById('regAddress').value = u.regAddress;
        }
        // èª­ã¿è¾¼ã¿å®Œäº†ã€ç”»é¢è¡¨ç¤º
        document.getElementById('loading').style.display = 'none';
        document.getElementById('input-screen').style.display = 'block';
        document.getElementById('price-bar').style.display = 'flex';
      }).catch(e => {
        console.error(e);
        document.getElementById('loading').style.display = 'none';
        document.getElementById('input-screen').style.display = 'block';
        alert("é€šä¿¡ã‚¨ãƒ©ãƒ¼: å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„");
      });

      fpInstance = flatpickr("#dateRange", { mode: "range", minDate: "today", dateFormat: "Y-m-d", locale: "ja", disableMobile: "true", onClose: function(sd){ if(sd.length>0&&sd[0].getDay()===4){alert("æœ¨æ›œæ—¥ã¯å®šä¼‘æ—¥ã®ãŸã‚è²¸å‡ºä¸å¯ã§ã™");fpInstance.clear();return;} calcTotal(); checkAvailability(); } });
    };

    // --- ãƒ­ã‚¸ãƒƒã‚¯ (Webç‰ˆã¨åŒã˜) ---
    function safeParseInt(val) { if (!val) return 0; const num = parseInt(val); return isNaN(num) ? 0 : num; }
    function calculatePrice(rates, hours) { const p4=safeParseInt(rates.p4),p8=safeParseInt(rates.p8),p24=safeParseInt(rates.p24),pAdd=safeParseInt(rates.pAdd); if(hours<=4)return p4;else if(hours<=8)return p8;else if(hours<=24)return p24;else{return p24+(pAdd*Math.ceil((hours-24)/24));} }
    function showBikeImage() { const s=document.getElementById('bikeSelect'); const c=document.getElementById('bike-image-container'); const i=document.getElementById('bike-image'); if(s.value!=="0"){const u=s.options[s.selectedIndex].dataset.image; if(u){i.src=u;c.style.display="block";}else{c.style.display="none";}}else{c.style.display="none";} }
    function showDesc(t,tx){ document.getElementById('desc-title').innerText=t; document.getElementById('desc-text').innerText=tx; document.getElementById('descModal').style.display='flex'; }
    function initClassSelect() { const s=document.getElementById('classSelect'); s.innerHTML='<option value="">ã‚¯ãƒ©ã‚¹ã‚’é¸æŠã—ã¦ãã ã•ã„</option>'; masterData.categories.forEach((c,i)=>{const o=document.createElement('option');o.value=i;o.textContent=c.name;s.appendChild(o);}); }
    function initOptionSelect() { const a=document.getElementById('optionArea'); a.innerHTML=""; masterData.options.forEach(o=>{ const div=document.createElement('div');div.className='option-row'; const help=o.desc?`<span class="help-icon" onclick="showDesc('${o.name}','${o.desc}')">(?)</span>`:""; div.innerHTML=`<div class="option-label">${o.name} ${help}</div><div class="option-price">ç›®å®‰: +Â¥${safeParseInt(o.p24).toLocaleString()}/æ—¥</div><select class="option-select" data-p4="${o.p4}" data-p8="${o.p8}" data-p24="${o.p24}" data-p-add="${o.pAdd}" data-name="${o.name}" onchange="calcTotal()"><option value="0">ãªã—</option><option value="1">1</option><option value="2">2</option></select>`; a.appendChild(div); }); }
    function updateBikeList(busy=[]) { const idx=document.getElementById('classSelect').value; const bs=document.getElementById('bikeSelect'); const cur=bs.value; bs.innerHTML='<option value="0">é¸æŠã—ã¦ãã ã•ã„</option>'; if(idx===""){bs.disabled=true;return;} masterData.categories[idx].bikes.forEach(b=>{ const o=document.createElement('option');o.value=b.name;o.dataset.p4=b.p4;o.dataset.p8=b.p8;o.dataset.p24=b.p24;o.dataset.pAdd=b.pAdd;o.dataset.image=b.image||""; if(busy.includes(b.name)){o.disabled=true;o.textContent=`âŒ ${b.name} (è²¸å‡ºä¸­)`;}else{o.textContent=b.name;} bs.appendChild(o); }); bs.disabled=false; if(cur&&!busy.includes(cur))bs.value=cur; showBikeImage(); calcTotal(); }
    function checkAvailability() { const d=fpInstance.selectedDates; if(d.length===0)return; const s=new Date(d[0]); s.setHours(document.getElementById('startTime').value); const e=new Date(d.length>1?d[1]:d[0]); e.setHours(document.getElementById('endTime').value); let busy=[]; allReservations.forEach(r=>{if(s<new Date(r.end)&&e>new Date(r.start))busy.push(r.bike);}); updateBikeList([...new Set(busy)]); }
    function calcTotal() { const d=fpInstance.selectedDates; if(d.length===0)return; const s=new Date(d[0]);s.setHours(document.getElementById('startTime').value); const e=new Date(d.length>1?d[1]:d[0]);e.setHours(document.getElementById('endTime').value); let diff=(e-s)/(1000*60*60); if(diff<=0){document.getElementById('days-display').innerText="æ—¥æ™‚ã‚¨ãƒ©ãƒ¼"; return;} document.getElementById('days-display').innerText=`åˆ©ç”¨æ™‚é–“: ${diff}æ™‚é–“`; const bs=document.getElementById('bikeSelect'); let bTotal=0; if(bs.value!=="0"){bTotal=calculatePrice(bs.options[bs.selectedIndex].dataset,diff);} let oTotal=0; document.querySelectorAll('.option-select').forEach(sel=>{if(sel.value>0)oTotal+=calculatePrice(sel.dataset,diff)*sel.value;}); document.getElementById('totalPriceDisplay').innerText="Â¥"+(bTotal+oTotal).toLocaleString(); document.getElementById('conf-price').innerText="Â¥"+(bTotal+oTotal).toLocaleString(); }
    function generateTimeOptions(id,s,e){const el=document.getElementById(id);for(let i=s;i<=e;i++){const o=document.createElement('option');o.value=i;o.text=i+":00";if(id==='startTime'&&i===10)o.selected=true;if(id==='endTime'&&i===18)o.selected=true;el.appendChild(o);}}
    function searchAddress(){const z=document.getElementById('zipcode').value;fetch(`https://zipcloud.ibsnet.co.jp/api/search?zipcode=${z}`).then(r=>r.json()).then(d=>{if(d.results)document.getElementById('regAddress').value=d.results[0].address1+d.results[0].address2+d.results[0].address3;else alert("ä½æ‰€ä¸æ˜");});}
    
    function showConfirm(){
      const nm=document.getElementById('regName').value; const ph=document.getElementById('regPhone').value; 
      if(!nm||!ph){alert("ãŠå®¢æ§˜æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");return;}
      if(fpInstance.selectedDates.length===0){alert("æœŸé–“ã‚’é¸æŠã—ã¦ãã ã•ã„");return;}
      if(document.getElementById('bikeSelect').value==="0"){alert("ãƒã‚¤ã‚¯ã‚’é¸æŠã—ã¦ãã ã•ã„");return;}
      document.getElementById('conf-name').innerText=nm; document.getElementById('conf-phone').innerText=ph;
      document.getElementById('conf-date').innerText=document.getElementById('dateRange').value;
      document.getElementById('conf-time').innerText=`${document.getElementById('startTime').value}:00 ã€œ ${document.getElementById('endTime').value}:00`;
      document.getElementById('conf-bike').innerText=document.getElementById('bikeSelect').value;
      document.getElementById('conf-price').innerText=document.getElementById('totalPriceDisplay').innerText;
      let opt=""; document.querySelectorAll('.option-select').forEach(s=>{if(s.value>0)opt+=`${s.dataset.name}Ã—${s.value}\n`;});
      document.getElementById('conf-options').innerText=opt||"ãªã—";
      document.getElementById('input-screen').style.display='none'; document.getElementById('price-bar').style.display='none'; document.getElementById('confirm-screen').style.display='block'; window.scrollTo(0,0);
    }
    function goBack(){ document.getElementById('confirm-screen').style.display='none'; document.getElementById('input-screen').style.display='block'; document.getElementById('price-bar').style.display='flex'; }
    function checkAgreements(){ const b=document.getElementById('finalSubmitBtn'); if(document.getElementById('checkTerms').checked&&document.getElementById('checkAge').checked){b.disabled=false;b.classList.add('active');}else{b.disabled=true;b.classList.remove('active');} }
    
    function sendToGas(){
      const btn=document.getElementById('finalSubmitBtn'); 
      btn.disabled=true; btn.classList.add('sending'); btn.innerText="é€ä¿¡ä¸­...";
      
      const ds=fpInstance.selectedDates; 
      const sYMD=`${ds[0].getFullYear()}/${ds[0].getMonth()+1}/${ds[0].getDate()}`; 
      const eDate=ds.length>1?ds[1]:ds[0]; 
      const eYMD=`${eDate.getFullYear()}/${eDate.getMonth()+1}/${eDate.getDate()}`;
      const fullS=`${sYMD} ${document.getElementById('startTime').value}:00`; 
      const fullE=`${eYMD} ${document.getElementById('endTime').value}:00`;
      const bikeName=document.getElementById('conf-bike').innerText;
      
      callGas("check_availability_final", {startDate:fullS, endDate:fullE, bikeName:bikeName}).then(d=>{
        if(d.result==='error'){ 
          alert("ç”³ã—è¨³ã‚ã‚Šã¾ã›ã‚“ã€‚ã‚¿ãƒƒãƒã®å·®ã§äºˆç´„ãŒåŸ‹ã¾ã‚Šã¾ã—ãŸã€‚"); 
          btn.disabled=false; btn.classList.remove('sending'); btn.innerText="äºˆç´„ç¢ºå®š"; 
          goBack(); 
        } else {
          const finalData = {
            userId: lineProfile ? lineProfile.userId : "uid",
            displayName: lineProfile ? lineProfile.displayName : document.getElementById('regName').value,
            regName: document.getElementById('regName').value,
            regKana: document.getElementById('regKana').value,
            regPhone: document.getElementById('regPhone').value,
            regZip: document.getElementById('zipcode').value,
            regAddress: document.getElementById('regAddress').value,
            email: "", 
            dateRange: `${fullS} ã€œ ${fullE}`, 
            totalDays: document.getElementById('days-display').innerText,
            bikeName: bikeName, 
            options: document.getElementById('conf-options').innerText,
            memo: document.getElementById('memo').value, 
            totalPrice: document.getElementById('conf-price').innerText
          };
          return callGas("reserve", finalData);
        }
      }).then(res => {
        if(res && res.result==='success') {
          alert("äºˆç´„ãŒå®Œäº†ã—ã¾ã—ãŸï¼");
          liff.closeWindow();
        } else {
          alert("äºˆç´„ã‚¨ãƒ©ãƒ¼: " + (res ? res.message : "ä¸æ˜ãªã‚¨ãƒ©ãƒ¼"));
          btn.disabled=false; btn.classList.remove('sending'); btn.innerText="äºˆç´„ç¢ºå®š";
        }
      }).catch(e=>{ 
        alert("é€šä¿¡ã‚¨ãƒ©ãƒ¼: " + e); 
        btn.disabled=false; btn.classList.remove('sending'); btn.innerText="äºˆç´„ç¢ºå®š"; 
      });
    }
  </script>
</body>
</html>
